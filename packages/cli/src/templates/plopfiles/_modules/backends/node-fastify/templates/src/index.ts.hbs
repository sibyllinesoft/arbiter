/**
 * {{pascalCase name}} Backend
 */

import Fastify from 'fastify';
import cors from '@fastify/cors';
import { registerRoutes } from './routes/index.js';

async function bootstrap() {
  const app = Fastify({ logger: false });
  await app.register(cors, { origin: true });
  await registerRoutes(app);

  const defaultPort = {{port}};
  const port = Number(process.env.PORT || defaultPort);
  const host = process.env.HOST || '0.0.0.0';

  try {
    await app.listen({ port, host });
    console.log('Service "{{name}}" listening on %d', port);
  } catch (error) {
    console.error(error);
    process.exit(1);
  }
}

if (process.env.NODE_ENV !== 'test') {
  bootstrap();
}

export { bootstrap };
