package com.{{snakeCase name}}

import io.github.cdimascio.dotenv.dotenv
import io.ktor.serialization.kotlinx.json.*
import io.ktor.server.application.*
import io.ktor.server.engine.*
import io.ktor.server.netty.*
import io.ktor.server.plugins.contentnegotiation.*
import io.ktor.server.plugins.cors.routing.*
import io.ktor.server.plugins.calllogging.*
import io.ktor.server.response.*
import io.ktor.server.routing.*
import kotlinx.serialization.Serializable
import com.{{snakeCase name}}.routes.healthRoutes

val dotenv = dotenv {
    ignoreIfMissing = true
}

@Serializable
data class Message(val message: String)

fun main() {
    val port = dotenv["PORT"]?.toIntOrNull() ?: 3000

    embeddedServer(Netty, port = port) {
        install(ContentNegotiation) {
            json()
        }
        install(CORS) {
            anyHost()
            allowHeader("Content-Type")
            allowHeader("Authorization")
        }
        install(CallLogging)

        routing {
            get("/") {
                call.respond(Message("Welcome to {{titleCase name}} API"))
            }
            healthRoutes()
        }
    }.start(wait = true)
}
